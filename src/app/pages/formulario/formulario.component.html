<!-- ========================================
     TOPBAR FIJA (fuera del @switch)
     Solo visible después de Bienvenida
========================================= -->
@if (pasoActual() > 0) {
<header class="topbar">
  <div class="topbar__left">
    <img src="AlmaIcon.svg" alt="Alma Nova Clinic" class="topbar__logo" />
    <span class="topbar__title">Paso {{ pasoActual() }} de {{ totalPasos - 1 }}</span>
  </div>

  <div class="topbar__center">
    <!-- Progreso visual (opcional: barra o indicador) -->
    <div class="progress-indicator">
      @for (step of [1,2,3,4,5]; track step) {
      <div
        class="progress-dot"
        [class.active]="pasoActual() === step"
        [class.completed]="pasoActual() > step"
      ></div>
      }
    </div>
  </div>

  <div class="topbar__right">
    <button mat-button (click)="retrocederPaso()" [disabled]="pasoActual() === 0">
      ← Anterior
    </button>

    @if (pasoActual() < totalPasos - 1) {
    <button
      mat-raised-button
      color="primary"
      (click)="avanzarPaso()"
      [class.disabled]="!canGoNext()"
    >
      Siguiente →
    </button>
    } @else {
    <button
      mat-raised-button
      color="accent"
      (click)="enviar()"
      [disabled]="!canSubmit() || submitState().status !== 'idle'"
    >
      @switch (submitState().status) { @case ('generating-pdf') {
      <mat-spinner diameter="20" style="display: inline-block; margin-right: 8px"></mat-spinner>
      Generando PDF... } @case ('sending-email') {
      <mat-spinner diameter="20" style="display: inline-block; margin-right: 8px"></mat-spinner>
      Enviando... } @case ('success') { ✓ ¡Enviado! } @case ('error') { ✗ Error - Reintentar }
      @default { ✓ Enviar } }
    </button>
    }

    <!-- Mensaje de error (debajo de los botones) -->
    @if (submitState().status === 'error' && submitState().error) {
    <div class="error-message">
      {{ submitState().error }}
    </div>
    }
  </div>
</header>
}

<!-- ========================================
     CONTENIDO VARIABLE (con @switch)
========================================= -->
<main class="form-content">
  @switch (pasoActual()) { @case (0) {
  <app-bienvenida (comenzar)="avanzarPaso()"></app-bienvenida>
  } @case (1) {
  <app-datos-personales
    [requestValidate]="triggerValidation()"
    (validChange)="onStepValidChange(1, $event)"
    (dataChange)="onStepDataChange(1, $event)"
  ></app-datos-personales>
  } @case (2) {

  <app-informacion-empleador
    [requestValidate]="triggerValidation()"
    (validChange)="onStepValidChange(2, $event)"
    (dataChange)="onStepDataChange(2, $event)"
  ></app-informacion-empleador>

  } @case (3) {
  <app-informacion-medica
    [requestValidate]="triggerValidation()"
    (validChange)="onStepValidChange(3, $event)"
    (dataChange)="onStepDataChange(3, $event)"
  ></app-informacion-medica>
  } @case (4) {
  <app-declaracion-jurada
    [requestValidate]="triggerValidation()"
    (validChange)="onStepValidChange(4, $event)"
    (dataChange)="onStepDataChange(4, $event)"
  ></app-declaracion-jurada>
  } @case (5) {
  <app-firma
    [requestValidate]="triggerValidation()"
    (validChange)="onStepValidChange(5, $event)"
    (dataChange)="onStepDataChange(5, $event)"
  ></app-firma>
  } }
</main>
